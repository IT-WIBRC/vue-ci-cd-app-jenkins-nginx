server {
    listen 7777; # Listen on the default port (or whatever you configure)
    server_name vts_metrics_endpoint;

    location /metrics {
        # This is the path the Nginx Exporter or Prometheus will hit
        vhost_traffic_status_display;

        # CRITICAL FIX: Explicitly set format to 'prometheus'.
        # For many VTS versions, this is the only way to disable JSON output
        # when a global config is overriding the default.
        vhost_traffic_status_display_format prometheus;

        # FIX: Allow the private IP ranges used by Docker (Class A, B, and C)
        allow 10.0.0.0/8;      # Class A (Docker often uses 10.x for custom networks)
        allow 172.16.0.0/12;   # Class B (Docker default bridge range is subset of this)
        allow 192.168.0.0/16;  # Class C
        deny all;
    }
}
